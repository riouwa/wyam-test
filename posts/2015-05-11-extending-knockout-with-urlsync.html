<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge" />

  <title>language - Extending Knockout Observables to Sync with Address Bar</title>
  <meta name="description" content="coala" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="riouwa">

  <link href="http://feeds.feedburner.com/riouwa" rel="alternate" title="riouwa (RSS)" type="application/atom+xml">
  <link rel="shortcut icon" href="/wyam-test/favicon.png" type="image/png">
  <link rel="icon" href="/wyam-test/favicon.png" type="image/png">

  <link href="/wyam-test/assets/ui/semantic.min.css" rel="stylesheet" />
  <link href="/wyam-test/assets/css/highlight.css" rel="stylesheet">

  <meta name="application-name" content="language" />
  <meta name="msapplication-tooltip" content="language" />
  <meta name="msapplication-starturl" content="/wyam-test/" />

  <meta property="og:title" content="language - Extending Knockout Observables to Sync with Address Bar" /> 
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://riouwa.github.io/wyam-test/posts/2015-05-11-extending-knockout-with-urlsync" />
  <meta property="og:site_name" content="riouwa" />

  <!-- TODO: More social graph meta tags -->
  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "WebSite",
      "name": "Kamranicus",
      "url": "https://kamranicus.com/",
      "sameAs": [
        "http://www.twitter.com/kamranayub"
      ]
  }
  </script>


  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="/wyam-test/assets/js/html5shiv.js"></script>
    <script src="/wyam-test/assets/js/respond.min.js"></script>
  <![endif]-->
  <script src="/assets/js/picturefill.min.js" async></script>

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1203259-13']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  

  


</head>

<body>

  <!-- Navigation -->
  <div class="ui container">
    <nav class="ui huge text site menu">
      
      <a class="header item" href="/wyam-test/">language</a>
      
      <div class="ui right item">
              <div class="item">
        <a href="/wyam-test/about">About</a>
      </div>
      <div class="item">
        <a href="/wyam-test/guides">Guides</a>
      </div>
      <div class="item">
        <a href="/wyam-test/projects">Projects</a>
      </div>
      <div class="item">
        <a href="/wyam-test/speaking">Speaking</a>
      </div>
      <div class="item">
        <a href="/wyam-test/test-page">Test-page</a>
      </div>
      <div class="item">
        <a href="/wyam-test/travel">Travel</a>
      </div>

      </div>
    </nav>
  </div>
  <!-- Page Header -->

  <header class="ui vertical masthead segment " id="intro-header">
    <div class="ui container">

    
<div class="ui basic vertical segment">
    <h1 class="ui  huge header">
      Extending Knockout Observables to Sync with Address Bar
    </h1>
                
    <div class="ui  sub header">        
Published on Monday, May 11, 2015<br>    </div>
        <div class="ui basic vertical spaced segment">
                    <a role="button" href="/wyam-test/tags/Gists" class="ui small compact button">Gists</a>
                    <a role="button" href="/wyam-test/tags/Knockoutjs" class="ui small compact button">Knockout.js</a>
                    <a role="button" href="/wyam-test/tags/OSS" class="ui small compact button">OSS</a>
        </div>     
</div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="ui stackable grid container">
    <div class="content column">
      

<div class="ui huge basic post content segment">
  <p>I made a tiny Knockout extender called <code>urlSync</code> that syncs an observable with the URL.</p>
<!-- More -->
<p>For <a href="http://keeptrackofmygames.com">Keep Track of My Games</a> I've been adding filtering to the game library.
I'm really proud of what I have, here's what it looks like in the UI:</p>
<p><img src="/posts/images/2015-05-11-filtering.png" class="img-fluid" alt="Filtering UI" /></p>
<p>A modal allows the user to drill down and pick what filters to apply, the modal updates to show what filters are applied and what's available with the current resultset.</p>
<p><img src="/posts/images/2015-05-11-filtering-modal.png" class="img-fluid" alt="Filtering Modal" /></p>
<p>When you're outside the modal, I show any filters being applied allowing one-click removal or toggling the filtering method between AND/OR.</p>
<p>To make it easy to serialize/deserialize filters, I created a custom filtering expression that is pretty standard around town:</p>
<pre><code>{facetName}:{facetValue},{facetValue},...|...
</code></pre>
<p>For example, representing the screenshot above, the filtering expression would be:</p>
<pre><code>Lists:6|Status:8|My+Platforms:1
</code></pre>
<p>If you muck with the expression, there shouldn't be any issues. Facets are validated against whatever the original unfiltered resultset is, so you cannot add arbitrary expressions--if you do, they will not show up in the server response. Strings are special because potentially they can include characters used to parse the expression, the simplest way to deal with it is by encoding them and then decoding the value.</p>
<pre><code>Tags:my%20awesome%2ctag,tag2|Status:4
</code></pre>
<p>Now, I wanted to talk about the filtering expression because it makes it really easy to do a bunch of things:</p>
<ol>
<li>Reading/writing from querystring or hash</li>
<li>Create a command textbox that can parse and autocomplete expressions</li>
<li>Allow the user to save &quot;views&quot; of their games</li>
</ol>
<p>Items 2 and 3 might be on the agenda for some later date but item 1 is required for being able to create pre-filtered routes or create links. Since the library is loaded through Knockout and Web API, we need to be able to pass any filter or parameters when the page is loaded and also keep track of what the current values are for filtering.</p>
<p>To achieve this, I created a really simple <a href="http://knockoutjs.com/documentation/extenders.html">Knockout Extender</a> called <strong>urlSync.</strong> All it does is initially load an observable from the hash (if found) or the querystring (if found). Then it observes the observable and keeps the <code>window.location.hash</code> updated.</p>
<p>This could easily be extended to use <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/API/DOM/Manipulating_the_browser_history">HTML5 <code>pushState</code></a>, if you wished. For now, managing the hash is &quot;good enough&quot; for my use case.</p>
<p>Here is a Gist of the extender:</p>
<script src="https://gist.github.com/kamranayub/3feba45dd2da3262b872.js"></script>
<p>It depends on <a href="http://medialize.github.io/URI.js">URI.js</a> and the <a href="http://medialize.github.io/URI.js/docs.html#fragment-abuse">URI.fragmentQuery</a> component. It also uses <a href="http://underscorejs.org">Underscore.js</a>, but that's just because I have it in my project already.</p>
<p>It's really simple to use, for example here's a snippet from my collection view model:</p>
<pre><code>// Flattened facets
ViewModel.facets = ko.observableArray([]);

// Selected (applied) facets
ViewModel.selectedFacets = ko.observableArray([]).extend({
    urlSync: {
	    param: &quot;filterBy&quot;,
	    read: function(value) {
	       return kt.utils.facetsFromString(value, ViewModel.facets);
	    },
	    write: kt.utils.facetsToString
    }
});

// Filter AND toggle
ViewModel.filterAnd = ko.observable(false).extend({ urlSync: &quot;filterAnd&quot; });
</code></pre>
<p>As you can see, the extender allows you to intercept read/write so you can perform any custom transformations (e.g. filtering objects to/from string). Because we're deserializing from a string and because the <code>checkedValue</code> binding is by reference, I pass in the existing facets collection to my utility, in order to preserve object references when required. On initial page load, this isn't required as the games haven't been fetched from the API yet. Once they are, my fetch method updates the observables. I could also modify the way I handle binding the checkboxes but this works.</p>
<p>The <code>urlSync</code> extender will then bind the observable values to the URL like this:</p>
<pre><code>users/kamran.ayub/lists/all#?
    sortBy=Name&amp;
    filterAnd=true&amp;
    filterBy=Status%3A8%7CLists%3A6%7CMy+Platforms%3A1
</code></pre>
<p>Since the extender can also fallback to reading from the querystring, we can create URLs that filter a user's collection:</p>
<pre><code>users/somebody/lists/all?filterBy=Platforms:2,5,40
</code></pre>
<p>Pretty neat and now allows anyone to copy/paste the URL and preserve any needed filtering state!</p>

</div>

<div class="ui horizontal divider">
  About Kamran
</div>

<div class="ui items">
  <div class="item">
    <div class="ui small circular image">
      <img src="/assets/images/me.jpg" title="Kamran Ayub">
    </div>

    <div class="content">
      <div class="description">
        coala Language theory website
      </div>
      <div class="extra">
        <a class="ui circular icon button" href="https://twitter.com/kamranayub" title="Twitter">
  <i class="twitter icon"></i>
</a>
<a class="ui circular icon button" href="https://github.com/kamranayub" title="GitHub">
  <i class="github icon"></i>
</a>
<a class="ui circular icon button" href="https://instagram.com/subkamran" title="Instagram">
  <i class="instagram icon"></i>
</a>
<a class="ui circular icon button" href="http://www.youtube.com/c/Kamranicus " title="YouTube">
  <i class="youtube icon"></i>
</a>
<a class="ui circular icon button" href="https://twitch.tv/kamranicus " title="YouTube">
  <i class="twitch icon"></i>
</a>
<a class="ui circular icon button" href="https://www.linkedin.com/in/subkamran" title="LinkedIn">
  <i class="linkedin icon"></i>
</a>
      </div>
    </div>
  </div>
</div>

<div id="disqus_thread"></div>

<script type="text/javascript">
    var disqus_shortname = 'kamranicus';
    var disqus_identifier = 'http://kamranicus.com/blog/2015/05/11/extending-knockout-with-urlsync/';
    var disqus_title = 'Extending Knockout Observables to Sync with Address Bar';
    var disqus_url = 'https://riouwa.github.io/wyam-test/posts/2015-05-11-extending-knockout-with-urlsync';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      <!-- Disqus -->
<div id="disqus_thread"></div>

<script type="text/javascript">
    var disqus_shortname = 'kamranicus';
    var disqus_identifier = 'http://kamranicus.com/blog/2015/05/11/extending-knockout-with-urlsync/';
    var disqus_title = 'Extending Knockout Observables to Sync with Address Bar';
    var disqus_url = 'https://riouwa.github.io/wyam-test/posts/2015-05-11-extending-knockout-with-urlsync';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>    </div>
  </div>

  <div class="ui divider"></div>
  
  <!-- Footer -->
  <footer>   
    <div class="ui center aligned container">
  <p class="ui grey sub header">Copyright © Kamran Ayub 2017</p>
  
  <div class="ui basic vertical segment">
    <a class="ui circular icon button" href="https://twitter.com/kamranayub" title="Twitter">
  <i class="twitter icon"></i>
</a>
<a class="ui circular icon button" href="https://github.com/kamranayub" title="GitHub">
  <i class="github icon"></i>
</a>
<a class="ui circular icon button" href="https://instagram.com/subkamran" title="Instagram">
  <i class="instagram icon"></i>
</a>
<a class="ui circular icon button" href="http://www.youtube.com/c/Kamranicus " title="YouTube">
  <i class="youtube icon"></i>
</a>
<a class="ui circular icon button" href="https://twitch.tv/kamranicus " title="YouTube">
  <i class="twitch icon"></i>
</a>
<a class="ui circular icon button" href="https://www.linkedin.com/in/subkamran" title="LinkedIn">
  <i class="linkedin icon"></i>
</a>
  </div>

  <p class="ui basic vertical segment">      
    <a href="http://feeds.feedburner.com/riouwa" class="ui right labeled icon button">
      Subscribe via RSS or email
      <i class="right rss icon"></i>
    </a>
  </p>  
  <p class="ui tiny basic vertical segment">
    <a href="https://wyam.io">Statically generated by Wyam</a>
  </p>
</div>

  </footer>

  <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous"></script>
  <script src="/wyam-test/assets/ui/semantic.min.js"></script>
  <script src="/wyam-test/assets/js/highlight.pack.js"></script>

  

  <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>